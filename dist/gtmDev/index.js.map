{"mappings":"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","sources":["src/index.js","src/class-lite-vimeo-gtm-tracker.ts"],"sourcesContent":["import { LiteVimeoGTMTracker } from './class-lite-vimeo-gtm-tracker';\n\n(function () {\n\t'use strict';\n\tnew LiteVimeoGTMTracker();\n})();\n","// import fakeGTM from './utilities/fakeGTM';\n// fakeGTM();\ntype ConfigObject = {\n\tevents: {\n\t\tplay: boolean;\n\t\tpause: boolean;\n\t\tcomplete: boolean;\n\t};\n\tpercentages: {\n\t\tevery: number | number[];\n\t\teach: number[];\n\t};\n\t_track?: {\n\t\tpercentages: {};\n\t};\n};\n\ndeclare global {\n\tinterface Window {\n\t\tdataLayer: {}[];\n\t\tVimeo?: Vimeo;\n\t}\n}\n\nexport class LiteVimeoGTMTracker {\n\tdataLayer: Window['dataLayer'];\n\tconfig: ConfigObject = {\n\t\tevents: {\n\t\t\tplay: true,\n\t\t\tpause: false,\n\t\t\tcomplete: true,\n\t\t},\n\t\tpercentages: {\n\t\t\tevery: 25,\n\t\t\teach: [0, 90],\n\t\t},\n\t};\n\n\tconstructor(config: ConfigObject) {\n\t\t// The API won't work on LT IE9, so we bail if we detect those User Agents\n\t\tif (navigator.userAgent.match(/MSIE [678]\\./gi)) return;\n\t\tconst liteVimeoEls = document.querySelectorAll('lite-vimeo');\n\t\tif (!liteVimeoEls || 0 === liteVimeoEls.length) return;\n\n\t\tthis.dataLayer = window.dataLayer;\n\t\tthis.config = { ...this.config, ...config };\n\t\tthis.cleanConfig();\n\n\t\tliteVimeoEls.forEach((el) => {\n\t\t\tel.addEventListener('click', () => {\n\t\t\t\twindow.dataLayer.push({\n\t\t\t\t\tevent: 'lite-vimeo-click',\n\t\t\t\t});\n\t\t\t\tthis.loadVimeoAPI(() => {\n\t\t\t\t\tthis.addVimeoListeners(\n\t\t\t\t\t\tel.shadowRoot.querySelector(\n\t\t\t\t\t\t\t'iframe'\n\t\t\t\t\t\t) as HTMLIFrameElement\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Sets up the config object\n\t */\n\tprivate cleanConfig() {\n\t\tthis.setPercentageValuesToArrays();\n\t\tthis.calcPercentages();\n\t}\n\n\t/**\n\t * Extends the config object to include _track, which holds a dictionary of percentages and values to track\n\t */\n\tprivate calcPercentages() {\n\t\tlet points = this.config.percentages.every as number[];\n\t\tlet percentagePoints: number[] = [];\n\n\t\tpoints.forEach((val) => {\n\t\t\tconst n = 100 / val; // val = 25, n = 4\n\t\t\tlet i = 1;\n\t\t\twhile (i < n) {\n\t\t\t\tconst point = val * i;\n\t\t\t\ti++;\n\t\t\t\tif (point > 0.0 && point < 100.0) {\n\t\t\t\t\tpercentagePoints.push(point);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tpercentagePoints = [\n\t\t\t...this.config.percentages.each,\n\t\t\t...percentagePoints,\n\t\t];\n\n\t\tthis.config._track = {\n\t\t\tpercentages: percentagePoints.reduce((prev, curr) => {\n\t\t\t\tprev[curr + '%'] = curr / 100.0;\n\t\t\t\treturn prev;\n\t\t\t}, {}),\n\t\t};\n\t}\n\n\t/**\n\t * Set every value in the percentages object to an array\n\t */\n\tprivate setPercentageValuesToArrays() {\n\t\tconst settings = [...Object.keys(this.config.percentages)];\n\t\tsettings.forEach((setting) => {\n\t\t\tlet values = this.config.percentages[setting];\n\t\t\tif (!Array.isArray(values)) values = [values];\n\t\t\tif (values) {\n\t\t\t\tthis.config.percentages[setting] = values.map(Number);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * If the Vimeo API isn't loaded, load it, then call the callback.\n\t * @param {Function} callback\n\t */\n\tprivate loadVimeoAPI(callback: Function) {\n\t\tif (!window.Vimeo) {\n\t\t\tthis.loadScript(callback);\n\t\t} else {\n\t\t\tcallback();\n\t\t}\n\t}\n\n\t/**\n\t * Wire up the Event listeners for the Vimeo player\n\t * @param {HTMLIFrameElement} el\n\t */\n\tprivate addVimeoListeners(el: HTMLIFrameElement) {\n\t\tconst video: Vimeo = new Vimeo.Player(el);\n\t\tconst vimeoVideoEvents = {\n\t\t\tplay: 'play',\n\t\t\tpause: 'pause',\n\t\t\tcomplete: 'ended',\n\t\t};\n\t\tvideo.getVideoTitle().then((title) => {\n\t\t\t['play', 'pause', 'complete'].forEach((key) => {\n\t\t\t\tif (this.config.events[`${key}`]) {\n\t\t\t\t\tvideo.on(vimeoVideoEvents[`${key}`], () => {\n\t\t\t\t\t\tthis.updateDataLayer(key, title);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst percentages = this.config._track?.percentages;\n\t\t\tif (percentages) {\n\t\t\t\tvideo.on('timeupdate', ({ percent }) => {\n\t\t\t\t\tvar key: string | number;\n\t\t\t\t\tfor (key in percentages) {\n\t\t\t\t\t\tif (percent >= percentages[key]) {\n\t\t\t\t\t\t\tthis.updateDataLayer(key, title);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Updates the GTM dataLayer with the video event\n\t * @param action\n\t * @param videoTitle\n\t */\n\tprivate updateDataLayer(action: string, videoTitle: string) {\n\t\tif (action.indexOf('%') === -1 && action.indexOf('play') === -1) {\n\t\t\tthis.dataLayer.push({\n\t\t\t\tevent: 'video',\n\t\t\t\tvideo_provider: 'vimeo',\n\t\t\t\tvideo_action: action,\n\t\t\t\tvideo_title: videoTitle.toLowerCase(),\n\t\t\t\tvideo_percent: undefined,\n\t\t\t});\n\t\t} else if (action === '0%') {\n\t\t\tthis.dataLayer.push({\n\t\t\t\tevent: 'video',\n\t\t\t\tvideo_provider: 'vimeo',\n\t\t\t\tvideo_action: 'start',\n\t\t\t\tvideo_title: videoTitle.toLowerCase(),\n\t\t\t\tvideo_percent: undefined,\n\t\t\t});\n\t\t} else if (action.indexOf('play') === -1) {\n\t\t\tthis.dataLayer.push({\n\t\t\t\tevent: 'video',\n\t\t\t\tvideo_provider: 'vimeo',\n\t\t\t\tvideo_action: 'progress',\n\t\t\t\tvideo_percent: action,\n\t\t\t\tvideo_title: videoTitle.toLowerCase(),\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Loads the Vimeo API script before the first script\n\t * @param callback {Function} A callback function\n\t */\n\tprivate loadScript(callback: Function) {\n\t\tconst src = 'https://player.vimeo.com/api/player.js';\n\t\tconst vimeoPlayerScript = document.createElement('script');\n\t\tvimeoPlayerScript.onload = () => {\n\t\t\tcallback();\n\t\t\tvimeoPlayerScript.onload = null;\n\t\t};\n\t\tvimeoPlayerScript.src = src;\n\t\tvimeoPlayerScript.async = true;\n\n\t\tconst scripts = document.getElementsByTagName('script');\n\t\tif (scripts.length > 0) {\n\t\t\tconst script = scripts[0];\n\t\t\tif (script && script.parentNode) {\n\t\t\t\tscript.parentNode.insertBefore(vimeoPlayerScript, script);\n\t\t\t}\n\t\t} else {\n\t\t\tdocument.head.appendChild(vimeoPlayerScript);\n\t\t}\n\t}\n}\n"],"names":[],"version":3,"file":"index.js.map"}